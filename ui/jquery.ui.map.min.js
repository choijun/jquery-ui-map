 /*!
 * jQuery UI Map 0.1.2
 * http://code.google.com/p/jquery-ui-map/
 *
 * Copyright (c) 2010 Johan Säll Larsson
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * Depends:
 *      jquery.ui.core.js
 *      jquery.ui.widget.js
 */
(function(b){var e=[],d=[],c=[],a=[];b.widget("ui.gmap",{options:{backgroundColor:null,center:new google.maps.LatLng(0,0),disableDefaultUI:false,disableDoubleClickZoom:false,draggable:true,draggableCursor:null,draggingCursor:null,keyboardShortcuts:true,mapTypeControl:true,mapTypeControlOptions:null,mapTypeId:google.maps.MapTypeId.ROADMAP,navigationControl:true,navigationControlOptions:null,noClear:false,scaleControl:false,scaleControlOptions:null,scrollwheel:false,streetViewControl:true,streetViewControlOptions:null,zoom:5,callback:null,debug:true},_create:function(){var f=this.element.attr("id");e[f]=new google.maps.Map(document.getElementById(f),this.options);d[f]=new Array;a[f]=new Array},_init:function(){if(b.isFunction(this.options.callback)){this.options.callback.call(this,this.getMap())}},detectBrowser:function(){if(navigator.userAgent.indexOf("iPhone")!=-1||navigator.userAgent.indexOf("Android")!=-1){this.element.width("100%");this.element.height("100%")}},getCurrentPosition:function(f,h,i,j){var g=this;if(navigator.geolocation){if(b.isFunction(f)&&b.isFunction(h)){navigator.geolocation.getCurrentPosition(f,h,j)}else{navigator.geolocation.getCurrentPosition(function(k){g.getMap().setCenter(new google.maps.LatLng(k.coords.latitude,k.coords.longitude))})}}else{if(b.isFunction(i)){i.call(this)}}},watchPosition:function(f,h,i,j){var g=this;if(navigator.geolocation){if(b.isFunction(f)&&b.isFunction(h)){g._getWatches().push(navigator.geolocation.watchPosition(f,h,j))}else{g._getWatches().push(navigator.geolocation.watchPosition(function(k){g.getMap().setCenter(new google.maps.LatLng(k.coords.latitude,k.coords.longitude))}))}}else{if(b.isFunction(i)){i.call(this)}}},sidebar:function(g,f){this.getMap().controls[f].push(document.getElementById(g))},addMarker:function(g,h){var f=new google.maps.Marker(jQuery.extend({map:this.getMap()},g));if(b.isFunction(h)){h.call(this,this.getMap(),f)}this._getMarkers().push(f);return f},addInfoWindow:function(f,i){var g=this;var h=new google.maps.InfoWindow(i);google.maps.event.addListener(f,"click",function(){h.open(g.getMap(),f);g.getMap().panTo(f.position)})},loadJSON:function(g,h,i){var f=this;b.getJSON(g,h,function(j){b.each(j.markers,function(n,k){if(b.isFunction(i)){i.call(this,n,k)}else{var l={position:new google.maps.LatLng(k.lat,k.lng)};f.addMarker(l)}})})},loadHTML:function(i,h,j){var g=this;switch(i){case"rdfa":var f=[];b("."+h+' [property="geo:lat_long"]').each(function(){f.push((b(this).attr("content")).split(","))});b("."+h).each(function(o){var n=b(this);var l={position:new google.maps.LatLng(f[o][0],f[o][1])};if(b.isFunction(j)){j.call(this,l,n.get(0),o)}else{var k=g.addMarker(l);var m=n.find(".summary");if(m!=null){g.addInfoWindow(k,{content:m.html()});m.click(function(){google.maps.event.trigger(k,"click");g.getMap().panTo(k.position);return false})}}});break;case"microformat":b("."+h).each(function(o){var n=b(this);var l={position:new google.maps.LatLng(n.find(".latitude").attr("title"),n.find(".longitude").attr("title"))};if(b.isFunction(j)){j.call(this,l,n.get(0),o)}else{var k=g.addMarker(l);var m=n.find(".summary");if(m!=null){g.addInfoWindow(k,{content:m.html()});m.click(function(){google.maps.event.trigger(k,"click");g.getMap().panTo(k.position);return false})}}});break;case"microdata":b("."+h).each(function(){var k=b(this);b(k).children().each(function(o){if(b(this).attr("itemprop")=="geo"){var p=b(this).html().split(";");var m={position:new google.maps.LatLng(p[0],p[1])};if(b.isFunction(j)){j.call(this,m,k.get(0),o)}else{var l=g.addMarker(m);var n=k.find(".summary");if(n!=null){g.addInfoWindow(l,{content:n.html()});n.click(function(){google.maps.event.trigger(l,"click");g.getMap().panTo(l.position);return false})}}}})});break}},loadFusion:function(h,f){var g=new google.maps.FusionTablesLayer(h,f);g.setMap(this.getMap())},loadDirections:function(h,i,g,f){var j=new google.maps.DirectionsRenderer({map:this.getMap(),panel:document.getElementById(h)});var k=new google.maps.DirectionsService();k.route({origin:i,destination:g,travelMode:f,provideRouteAlternatives:true},function(m,l){if(l==google.maps.DirectionsStatus.OK){j.setDirections(m)}else{alert("Couldnt find directions, "+l)}})},loadStreetViewPanorama:function(g,f){var h=new google.maps.StreetViewPanorama(document.getElementById(g),f);this.getMap().setStreetView(h)},search:function(i,f,h){var g=this;var j=new google.maps.Geocoder();j.geocode(i,function(l,k){if(k==google.maps.GeocoderStatus.OK){if(b.isFunction(f)){f.call(this,l)}else{g.getMap().setCenter(l[0].geometry.location)}}else{if(b.isFunction(h)){h.call(this,k)}}})},clearMarkers:function(){var g=this._getMarkers();for(var f=0;f<g.length;f++){google.maps.event.clearInstanceListeners(g[f]);g[f].setMap(null)}g=new Array()},clearWatches:function(){if(navigator.geolocation){var f=this._getWatches();for(var g=0;g<f.length;g++){navigator.geolocation.clearWatch([id][g])}f=new Array()}},destroy:function(){this.clearWatches();this.clearMarkers();var f=this.getMap();f=null;this.element.removeAttr("style");this.element.html("");this.options.map=null;b.Widget.prototype.destroy.call(this)},getMap:function(){return e[this.element.attr("id")]},_getMarkers:function(){return d[this.element.attr("id")]},_getWatches:function(){return a[this.element.attr("id")]},_setOption:function(f,g){switch(f){case"backgroundColor":this.options.backgroundColor=g;this.getMap().setOptions(this.options);break;case"disableDefaultUI":this.options.disableDefaultUI=g;this.getMap().setOptions(this.options);break;case"disableDoubleClickZoom":this.options.disableDoubleClickZoom=g;this.getMap().setOptions(this.options);break;case"draggable":this.options.draggable=g;this.getMap().setOptions(this.options);break;case"draggableCursor":this.options.draggableCursor=g;this.getMap().setOptions(this.options);break;case"draggingCursor":this.options.draggingCursor=g;this.getMap().setOptions(this.options);break;case"keyboardShortcuts":this.options.keyboardShortcuts=g;this.getMap().setOptions(this.options);break;case"mapTypeControl":this.options.mapTypeControl=g;this.getMap().setOptions(this.options);break;case"mapTypeControlOptions":this.options.mapTypeControlOptions=g;this.getMap().setOptions(this.options);break;case"navigationControl":this.options.navigationControl=g;this.getMap().setOptions(this.options);break;case"navigationControlOptions":this.options.navigationControlOptions=g;this.getMap().setOptions(this.options);break;case"noClear":this.options.noClear=g;this.getMap().setOptions(this.options);break;case"scaleControl":this.options.scaleControl=g;this.getMap().setOptions(this.options);break;case"scaleControlOptions":this.options.scaleControlOptions=g;this.getMap().setOptions(this.options);break;case"scrollwheel":this.options.scrollwheel=g;this.getMap().setOptions(this.options);break;case"streetViewControl":this.options.streetViewControl=g;this.getMap().setOptions(this.options);break;case"streetViewControlOptions":this.options.streetViewControlOptions=g;this.getMap().setOptions(this.options);break;case"center":this.options.center=g;this.getMap().setCenter(g);break;case"mapTypeId":this.options.mapTypeId=g;this.getMap().setMapTypeId(g);break;case"zoom":this.options.zoom=g;this.getMap().setZoom(g);break}b.Widget.prototype._setOption.apply(this,arguments)}})}(jQuery));